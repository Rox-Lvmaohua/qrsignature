# QRç­¾åç³»ç»Ÿ - å‰ç«¯ç‹¬ç«‹åŒ–ä¸åŠŸèƒ½ä¼˜åŒ–å®ç°æ–¹æ¡ˆ

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°
æœ¬æ–¹æ¡ˆæ—¨åœ¨å®ç°å‰ç«¯ä»£ç ç‹¬ç«‹åŒ–éƒ¨ç½²ã€ä¼˜åŒ–ç”¨æˆ·ä½“éªŒï¼Œå¹¶å®Œå–„ç”¨æˆ·ç­¾åä¿å­˜åŠŸèƒ½çš„å”¯ä¸€ç´¢å¼•æ£€æŸ¥æœºåˆ¶ã€‚

## ğŸ¯ ç›®æ ‡

### 1. å‰ç«¯ä»£ç ç‹¬ç«‹åŒ–
- å°†å‰ç«¯ä»£ç ä»Spring Booté¡¹ç›®ä¸­åˆ†ç¦»
- ä½¿ç”¨ç°ä»£å‰ç«¯æ„å»ºå·¥å…·è¿›è¡Œä¼˜åŒ–
- å®ç°ç‹¬ç«‹éƒ¨ç½²ï¼Œä¸éœ€è¦CDNåˆ†å‘

### 2. ç”¨æˆ·ç­¾åä¿å­˜åŠŸèƒ½ä¼˜åŒ–
- å®ç°ç”¨æˆ·ç­¾åå”¯ä¸€æ€§æ£€æŸ¥
- é˜²æ­¢é‡å¤ä¿å­˜ç›¸åŒç”¨æˆ·çš„ç­¾å
- æä¾›å‹å¥½çš„é”™è¯¯æç¤ºå’Œç”¨æˆ·ä½“éªŒ

## ğŸ¯ æŠ€æœ¯å®ç°æ–¹æ¡ˆ

### 1. å‰ç«¯ç‹¬ç«‹æ¶æ„æ–¹æ¡ˆ

#### æ–¹æ¡ˆA: Node.jså‰ç«¯ç‹¬ç«‹éƒ¨ç½² (æ¨è)
```
frontend/
â”œâ”€â”€ public/                 # é™æ€èµ„æº
â”‚   â”œâ”€â”€ index.html         # ä¸»é¡µé¢
â”‚   â”œâ”€â”€ signing.html       # ç­¾åé¡µé¢
â”‚   â””â”€â”€ sign.html          # å¤‡ç”¨ç­¾åé¡µé¢
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ js/
â”‚   â”‚   â”œâ”€â”€ app.js         # æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â”œâ”€â”€ qrcode.js      # äºŒç»´ç å¤„ç†
â”‚   â”‚   â”œâ”€â”€ canvas.js      # ç­¾åç”»å¸ƒ
â”‚   â”‚   â””â”€â”€ api.js         # APIè¯·æ±‚å°è£…
â”‚   â”œâ”€â”€ css/
â”‚   â”‚   â”œâ”€â”€ main.css       # ä¸»æ ·å¼
â”‚   â”‚   â””â”€â”€ components/    # ç»„ä»¶æ ·å¼
â”‚   â””â”€â”€ components/        # Reactç»„ä»¶ (å¯é€‰)
â”œâ”€â”€ package.json
â”œâ”€â”€ webpack.config.js      # æ„å»ºé…ç½®
â””â”€â”€ .env                   # ç¯å¢ƒå˜é‡
```

#### æ–¹æ¡ˆB: é™æ€èµ„æºç‹¬ç«‹ç›®å½•
```
qrsignature/
â”œâ”€â”€ backend/               # Spring Bootåç«¯
â””â”€â”€ frontend/              # å‰ç«¯èµ„æº
    â”œâ”€â”€ index.html
    â”œâ”€â”€ signing.html
    â”œâ”€â”€ app.js
    â””â”€â”€ assets/           # é™æ€èµ„æº
```

### 2. ä¿å­˜ç­¾åå†²çªæ£€æŸ¥æ–¹æ¡ˆ

#### æ•°æ®åº“å±‚é¢ä¼˜åŒ–
```java
// åœ¨UserSignatureRepositoryä¸­æ·»åŠ å†²çªæ£€æŸ¥æ–¹æ³•
@Query("SELECT COUNT(us.userId) > 0 FROM UserSignature us WHERE us.userId = :userId")
boolean existsByUserId(@Param("userId") String userId);

// åœ¨SignServiceä¸­æ·»åŠ æ£€æŸ¥é€»è¾‘
public boolean canSaveUserSignature(String userId) {
    return !userSignatureRepository.existsByUserId(userId);
}
```

#### ä¸šåŠ¡é€»è¾‘ä¼˜åŒ–
```java
// ä¿®æ”¹confirmSignæ–¹æ³•ä¸­çš„ä¿å­˜é€»è¾‘
if (request.getSaveForReuse() != null && request.getSaveForReuse()) {
    if (!canSaveUserSignature(signRecord.getUserId())) {
        throw new RuntimeException("è¯¥ç”¨æˆ·å·²å­˜åœ¨å†å²ç­¾åï¼Œä¸å¯é‡å¤ä¿å­˜");
    }
    saveUserSignature(signRecord.getUserId(), signatureBase64);
}
```

#### å‰ç«¯äº¤äº’ä¼˜åŒ–
```javascript
// åœ¨ç­¾åç¡®è®¤å‰æ£€æŸ¥å†å²ç­¾åçŠ¶æ€
async checkCanSaveSignature(userId) {
    try {
        const response = await fetch(`${this.apiUrl}/check-signature-exists?userId=${encodeURIComponent(userId)}`);
        const data = await response.json();
        return data.canSave;
    } catch (error) {
        console.error('æ£€æŸ¥ç­¾åä¿å­˜æƒé™å¤±è´¥:', error);
        return false;
    }
}
```

## ğŸš€ å®æ–½æ­¥éª¤

### é˜¶æ®µ1: å‰ç«¯ç‹¬ç«‹åŒ–é‡æ„
1. **åˆ›å»ºå‰ç«¯ç‹¬ç«‹ç›®å½•ç»“æ„**
2. **é‡æ„app.jsä¸ºæ¨¡å—åŒ–æ¶æ„**
3. **åˆ†ç¦»CSSåˆ°ç‹¬ç«‹æ–‡ä»¶**
4. **æ·»åŠ æ„å»ºè„šæœ¬å’Œé…ç½®**

### é˜¶æ®µ2: ç­¾åå†²çªæ£€æŸ¥å®ç°
1. **æ·»åŠ RepositoryæŸ¥è¯¢æ–¹æ³•**
2. **å®ç°SignServiceå†²çªæ£€æŸ¥**
3. **æ·»åŠ æ–°çš„APIç«¯ç‚¹**
4. **å‰ç«¯é›†æˆæ£€æŸ¥é€»è¾‘**

### é˜¶æ®µ3: å‰ç«¯ä¼˜åŒ–å’Œéƒ¨ç½²
1. **æ·»åŠ é”™è¯¯å¤„ç†å’Œç”¨æˆ·ä½“éªŒä¼˜åŒ–**
2. **é…ç½®ç‹¬ç«‹éƒ¨ç½²æ–¹æ¡ˆ**
3. **æ·»åŠ ç¯å¢ƒå˜é‡é…ç½®**
4. **æµ‹è¯•å’Œæ–‡æ¡£å®Œå–„**

## ğŸ“‹ APIè®¾è®¡è¡¥å……

### æ–°å¢APIç«¯ç‚¹
```http
# æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å¯ä»¥ä¿å­˜ç­¾å
GET /api/sign/check-signature-exists?userId={userId}

Response:
{
    "canSave": true/false,
    "message": "å¯ä»¥ä¿å­˜"/"å·²å­˜åœ¨å†å²ç­¾å"
}
```

### ä¿®æ”¹ç°æœ‰API
```http
# ç­¾åç¡®è®¤æ¥å£å¢å¼º
POST /api/sign/confirm

Request:
{
    "signatureBase64": "base64-data",
    "saveForReuse": true,
    "userSignatureId": "optional-id"
}

Error Response:
{
    "code": "SIGNATURE_EXISTS",
    "message": "è¯¥ç”¨æˆ·å·²å­˜åœ¨å†å²ç­¾åï¼Œä¸å¯é‡å¤ä¿å­˜"
}
```

## ğŸ”§ æŠ€æœ¯æ ˆå»ºè®®

### å‰ç«¯æŠ€æœ¯æ ˆ
- **æ„å»ºå·¥å…·**: Webpack 5
- **æ ·å¼åº“**ï¼šbootstraps
- **åŒ…ç®¡ç†**: npm/yarn
- **ä»£ç è§„èŒƒ**: ESLint + Prettier
- **ç‰ˆæœ¬æ§åˆ¶**: Git
- **éƒ¨ç½²**: é™æ€æ–‡ä»¶æœåŠ¡å™¨ (Nginx)

### åç«¯å¢å¼º
- **å¼‚å¸¸å¤„ç†**: ç»Ÿä¸€å¼‚å¸¸å¤„ç†æœºåˆ¶
- **æ—¥å¿—è®°å½•**: å®Œå–„çš„æ—¥å¿—è¿½è¸ª
- **ç¼“å­˜ä¼˜åŒ–**: ä½¿ç”¨æœ¬åœ°ç¼“å­˜ç¼“å­˜ç”¨æˆ·ç­¾åä¿¡æ¯ï¼Œä¸éœ€è¦Redis
- **å®‰å…¨æ€§**: ç­¾åæ•°æ®éªŒè¯å’Œæ¸…ç†

## ğŸ“Š é¢„æœŸæ•ˆæœ

1. **ç‹¬ç«‹éƒ¨ç½²**: å‰ç«¯å¯ç‹¬ç«‹éƒ¨ç½²å’Œç‰ˆæœ¬ç®¡ç†
2. **å†²çªå¤„ç†**: å®Œå–„çš„ç­¾åä¿å­˜å†²çªæ£€æŸ¥æœºåˆ¶
3. **ç”¨æˆ·ä½“éªŒ**: æ¸…æ™°çš„é”™è¯¯æç¤ºå’Œå¼•å¯¼
4. **ä»£ç ç»´æŠ¤**: æ¨¡å—åŒ–ã€å¯ç»´æŠ¤çš„ä»£ç ç»“æ„
5. **æ‰©å±•æ€§**: ä¸ºæœªæ¥åŠŸèƒ½æ‰©å±•å¥ å®šåŸºç¡€

## ğŸ“ å®æ–½æ¸…å•

### åç«¯å®ç°æ¸…å•
- [ ] æ·»åŠ UserSignatureRepository.existsByUserIdæ–¹æ³•
- [ ] ä¿®æ”¹SignService.confirmSignæ–¹æ³•ï¼Œæ·»åŠ å†²çªæ£€æŸ¥
- [ ] æ–°å¢GET /api/sign/check-signature-exists APIç«¯ç‚¹
- [ ] å®Œå–„å¼‚å¸¸å¤„ç†æœºåˆ¶
- [ ] æ·»åŠ å•å…ƒæµ‹è¯•

### å‰ç«¯å®ç°æ¸…å•
- [ ] åˆ›å»ºå‰ç«¯ç‹¬ç«‹ç›®å½•ç»“æ„
- [ ] é‡æ„app.jsä¸ºæ¨¡å—åŒ–æ¶æ„
- [ ] åˆ†ç¦»CSSåˆ°ç‹¬ç«‹æ–‡ä»¶
- [ ] æ·»åŠ ç­¾åä¿å­˜æ£€æŸ¥é€»è¾‘
- [ ] ä¼˜åŒ–é”™è¯¯æç¤ºå’Œç”¨æˆ·ä½“éªŒ
- [ ] æ·»åŠ æ„å»ºé…ç½®

### éƒ¨ç½²æ¸…å•
- [ ] é…ç½®å‰ç«¯ç‹¬ç«‹éƒ¨ç½²
- [ ] æ·»åŠ ç¯å¢ƒå˜é‡é…ç½®
- [ ] æ›´æ–°éƒ¨ç½²æ–‡æ¡£
- [ ] é›†æˆæµ‹è¯•